<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ãƒ›ãƒ¼ãƒ  - ã¤ã¶ãƒŠãƒ“</title>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Zen Maru Gothic', sans-serif; background: linear-gradient(135deg, #FFF8E1 0%, #FFE0B2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        header { background: #FFF; padding: 25px 40px; border-radius: 30px; box-shadow: 0 8px 24px rgba(255, 152, 0, 0.15); margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 32px; font-weight: bold; color: #FF9800; }
        nav { display: flex; gap: 15px; }
        .nav-btn { padding: 12px 24px; border-radius: 30px; text-decoration: none; color: #666; background: #FFF; transition: all 0.3s; }
        .nav-btn.active { background: linear-gradient(135deg, #FFB74D 0%, #FF9800 100%); color: white; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3); }
        .card { background: #FFF; border-radius: 30px; padding: 30px; box-shadow: 0 8px 24px rgba(255, 152, 0, 0.1); margin-bottom: 30px; }
        .card-title { font-size: 24px; font-weight: bold; margin-bottom: 20px; color: #FF9800; }
        .ai-companion { background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); border: 3px solid #FFB74D; border-radius: 25px; padding: 25px; margin-bottom: 20px; }
        .ai-avatar { width: 70px; height: 70px; border-radius: 50%; background: linear-gradient(135deg, #FFB74D 0%, #FF9800 100%); display: flex; align-items: center; justify-content: center; font-size: 40px; float: left; margin-right: 20px; box-shadow: 0 6px 18px rgba(255, 152, 0, 0.3); }
        .ai-message { font-size: 16px; line-height: 1.8; color: #5D4037; }
        .tweet-box { background: #FFFBF5; border-radius: 20px; padding: 20px; border: 2px solid #FFE0B2; }
        .tweet-input { width: 100%; border: none; font-size: 16px; resize: none; outline: none; min-height: 100px; font-family: 'Zen Maru Gothic', sans-serif; background: transparent; color: #5D4037; }
        .tweet-button { background: linear-gradient(135deg, #FFB74D 0%, #FF9800 100%); color: white; border: none; padding: 12px 30px; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 16px; float: right; margin-top: 15px; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3); font-family: 'Zen Maru Gothic', sans-serif; }
        .tweet-button:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(255, 152, 0, 0.4); }
        .main-content { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }
        .report-item { background: #FFFBF5; border-radius: 15px; padding: 15px; margin-bottom: 10px; border: 2px solid #FFE0B2; cursor: pointer; transition: all 0.3s; }
        .report-item:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2); }
        .report-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .report-date { font-weight: bold; color: #FF9800; }
        .report-status { background: #E8F5E9; color: #388E3C; padding: 4px 8px; border-radius: 10px; font-size: 11px; }
        .report-content { background: #FFFBF5; padding: 15px; border-radius: 15px; border: 2px solid #FFE0B2; margin-top: 10px; display: none; color: #5D4037; line-height: 1.6; }
        .growth-feedback { background: #E8F5E9; padding: 15px; border-radius: 15px; border: 2px solid #81C784; margin-top: 10px; color: #2E7D32; line-height: 1.6; }
        .kanban-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .kanban-column { background: #FFFBF5; border-radius: 25px; padding: 20px; min-height: 400px; border: 2px solid #FFE0B2; }
        .column-header { font-weight: bold; font-size: 18px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #FFE0B2; color: #FF9800; }
        .task-card { background: white; padding: 18px; border-radius: 20px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(255, 152, 0, 0.1); cursor: move; border: 2px solid #FFF3E0; }
        .task-card:hover { transform: translateY(-3px); box-shadow: 0 6px 18px rgba(255, 152, 0, 0.2); }
        .task-title { font-size: 15px; margin-bottom: 12px; font-weight: 500; color: #5D4037; }
        .skill-tags { display: flex; gap: 8px; flex-wrap: wrap; }
        .skill-tag { background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%); color: #F57C00; padding: 5px 12px; border-radius: 15px; font-size: 12px; font-weight: 500; border: 1px solid #FFB74D; }
        .skill-display { text-align: center; color: #5D4037; font-size: 16px; font-weight: bold; margin-top: 20px; }
        #skillLevel { color: #FF9800; font-size: 28px; transition: all 0.5s; }
        .skill-level-up { animation: levelUp 0.8s ease-out; }
        @keyframes levelUp { 0% { transform: scale(1); } 50% { transform: scale(1.5); color: #FF6F00; } 100% { transform: scale(1); } }
        .balloon { position: fixed; font-size: 40px; animation: flyUp 3s ease-out forwards; pointer-events: none; z-index: 9999; }
        @keyframes flyUp { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-100vh) rotate(20deg); opacity: 0; } }
        .radar-pulse { animation: radarPulse 0.6s ease-out; }
        @keyframes radarPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        .tweet-history { margin-top: 30px; }
        .tweet-item { background: #FFFBF5; border-radius: 20px; padding: 15px; margin-bottom: 10px; border: 2px solid #FFE0B2; }
        .tweet-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .tweet-time { font-size: 12px; color: #999; }
        .tweet-text { color: #5D4037; line-height: 1.6; margin-bottom: 8px; }
        .tweet-tags { display: flex; gap: 6px; flex-wrap: wrap; }
        .tag { padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 500; }
        .tag-task { background: #E3F2FD; color: #1976D2; border: 1px solid #90CAF9; }
        .tag-positive { background: #E8F5E9; color: #388E3C; border: 1px solid #81C784; }
        .tag-negative { background: #FFEBEE; color: #D32F2F; border: 1px solid #EF9A9A; }
        .cheer-message { background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%); border: 3px solid #81C784; border-radius: 25px; padding: 20px; margin-bottom: 20px; animation: cheerPulse 2s ease-in-out infinite; }
        @keyframes cheerPulse { 0%, 100% { box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3); } 50% { box-shadow: 0 8px 24px rgba(76, 175, 80, 0.5); } }
        .cheer-icon { font-size: 40px; margin-bottom: 10px; animation: cheerBounce 1s ease-in-out infinite; }
        @keyframes cheerBounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .cheer-text { color: #2E7D32; font-size: 18px; font-weight: bold; line-height: 1.6; }
        .cheer-from { color: #66BB6A; font-size: 14px; margin-top: 10px; }
        .view-request { background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border: 3px solid #64B5F6; border-radius: 25px; padding: 20px; margin-bottom: 20px; }
        .request-header { color: #1565C0; font-size: 16px; font-weight: bold; margin-bottom: 10px; }
        .request-content { color: #1976D2; margin-bottom: 15px; line-height: 1.6; }
        .request-buttons { display: flex; gap: 10px; }
        .approve-btn { background: linear-gradient(135deg, #66BB6A 0%, #4CAF50 100%); color: white; border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-weight: bold; }
        .reject-btn { background: linear-gradient(135deg, #EF5350 0%, #F44336 100%); color: white; border: none; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-weight: bold; }
        .public-footprints { background: #FFFBF5; border-radius: 20px; padding: 20px; margin-top: 20px; border: 2px solid #FFE0B2; }
        .footprint-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(255, 152, 0, 0.1); }
        .footprint-header { display: flex; justify-content: between; align-items: center; margin-bottom: 8px; }
        .footprint-date { color: #999; font-size: 12px; }
        .footprint-text { color: #5D4037; margin-bottom: 8px; }
        .footprint-skill { color: #FF9800; font-size: 12px; font-weight: bold; }
        .struggle-suggestion { position: fixed; bottom: 30px; right: 30px; background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 100%); border: 3px solid #64B5F6; border-radius: 25px; padding: 25px; max-width: 400px; box-shadow: 0 8px 24px rgba(33, 150, 243, 0.3); z-index: 1000; animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { transform: translateX(500px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .struggle-suggestion .ai-message { color: #1565C0; font-size: 15px; margin-bottom: 15px; }
        .matched-user { background: white; padding: 15px; border-radius: 15px; margin: 10px 0; border: 2px solid #90CAF9; }
        .matched-user span { display: block; color: #1976D2; font-weight: bold; margin-bottom: 8px; }
        .matched-user small { display: block; color: #666; font-size: 13px; margin-bottom: 10px; }
        .matched-user button { background: linear-gradient(135deg, #64B5F6 0%, #42A5F5 100%); color: white; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; width: 100%; }
        .matched-user button:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4); }
        .close-suggestion { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 24px; cursor: pointer; color: #1976D2; }
        #journeyModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; }
        .journey-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 30px; padding: 40px; max-width: 700px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .journey-step { background: #FFFBF5; border-radius: 20px; padding: 20px; margin-bottom: 20px; border-left: 5px solid #FFB74D; }
        .journey-step.è‹¦æ‚©æœŸ { border-left-color: #EF5350; }
        .journey-step.æ¨¡ç´¢æœŸ { border-left-color: #FFA726; }
        .journey-step.æˆé•·æœŸ { border-left-color: #66BB6A; }
        .journey-step.å…‹æœæœŸ { border-left-color: #42A5F5; }
        .phase-badge { display: inline-block; background: #FFB74D; color: white; padding: 5px 15px; border-radius: 15px; font-size: 12px; font-weight: bold; margin-bottom: 10px; }
        .journey-step .timestamp { color: #999; font-size: 13px; margin-bottom: 5px; }
        .journey-step .content { color: #5D4037; line-height: 1.6; margin-bottom: 10px; }
        .journey-step .action { color: #1976D2; margin: 8px 0; }
        .journey-step .insight { color: #388E3C; margin: 8px 0; }
        @media (max-width: 1200px) { .main-content { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">ğŸ’¬ ã¤ã¶ãƒŠãƒ“</div>
            <nav>
                <a href="home_tsubunavi.html" class="nav-btn active">ğŸ  ãƒ›ãƒ¼ãƒ </a>
                <a href="forest_tsubunavi.html" class="nav-btn">ğŸŒ² ã‚ã—ã‚ã¨ã¨é‡Œ</a>
                <a href="bonfire_premium.html" class="nav-btn">ğŸ”¥ å¤œã®ç„šç«åºƒå ´</a>
                <a href="ai-test.html" class="nav-btn">ğŸ¤– AIæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</a>
            </nav>
            <div id="userName" style="font-weight: bold; color: #5D4037;">user_12345</div>
        </header>
        
        <div class="card">
            <div class="card-title">ğŸŒŸ ä»Šæ—¥ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼</div>
            <div id="cheerMessages"></div>
            <div id="viewRequests"></div>
            <div class="ai-companion">
                <div class="ai-avatar">ğŸ»</div>
                <div class="ai-message" id="aiMessage">
                    <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
                </div>
            </div>
            <div class="tweet-box">
                <textarea class="tweet-input" id="tweetInput" placeholder="ä»Šæ—¥ã®æ°—æŒã¡ã‚„è€ƒãˆã‚’ã¤ã¶ã‚„ã„ã¦ãã ã•ã„..."></textarea>
                <button class="tweet-button" onclick="postTweet()">ã¤ã¶ã‚„ã</button>
            </div>
        </div>
        
        <div class="main-content">
            <div>
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div class="card-title" style="margin-bottom: 0;">ğŸ“š éå»ã®æ—¥å ±ä¸€è¦§</div>
                        <button class="tweet-button" style="margin: 0; float: none;" onclick="generateFootprint()">ğŸ‘£ ã‚ã—ã‚ã¨ç”Ÿæˆ</button>
                    </div>
                    <div id="reportList">
                        <!-- å‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
                    </div>
                </div>
            </div>
            
            <div>
                <div class="card">
                    <div class="card-title">ğŸ“‹ ã‚¿ã‚¹ã‚¯ãƒœãƒ¼ãƒ‰</div>
                    <div class="kanban-board">
                        <div class="kanban-column" ondrop="drop(event)" ondragover="allowDrop(event)" data-column="pending">
                            <div class="column-header">â³ å¾…æ©Ÿä¸­</div>
                            <div class="task-card" draggable="true" ondragstart="drag(event)" id="task1" data-skill="æŠ€è¡“å­¦ç¿’">
                                <div class="task-title">æ–°ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®èª¿æŸ»</div>
                                <div class="skill-tags"><span class="skill-tag">æŠ€è¡“å­¦ç¿’</span></div>
                            </div>
                            <div class="task-card" draggable="true" ondragstart="drag(event)" id="task2" data-skill="ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³">
                                <div class="task-title">ãƒãƒ¼ãƒ ä¼šè­°ã®æº–å‚™</div>
                                <div class="skill-tags"><span class="skill-tag">ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³</span></div>
                            </div>
                        </div>
                        
                        <div class="kanban-column" ondrop="drop(event)" ondragover="allowDrop(event)" data-column="inprogress">
                            <div class="column-header">ğŸ”„ å®Ÿæ–½ä¸­</div>
                            <div class="task-card" draggable="true" ondragstart="drag(event)" id="task3" data-skill="ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ">
                                <div class="task-title">APIè¨­è¨ˆæ›¸ã‚’ä½œæˆ</div>
                                <div class="skill-tags"><span class="skill-tag">ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ</span></div>
                            </div>
                        </div>
                        
                        <div class="kanban-column" ondrop="drop(event)" ondragover="allowDrop(event)" data-column="done">
                            <div class="column-header">âœ… å®Œäº†</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div class="card-title" style="margin-bottom: 0;">ğŸ“ ä»Šæ—¥ã®ã¤ã¶ã‚„ã</div>
                <button class="tweet-button" style="margin: 0; float: none;" onclick="generateReport()">ğŸ“„ æ—¥å ±ç”Ÿæˆ</button>
            </div>
            <div class="tweet-history" id="tweetHistory"></div>
        </div>
        
        <div class="card" id="reportCard" style="display: none;">
            <div class="card-title">ğŸ“„ æ—¥å ±ä¸‹æ›¸ã</div>
            <textarea id="reportContent" style="width: 100%; min-height: 300px; white-space: pre-wrap; line-height: 1.8; color: #5D4037; background: #FFFBF5; padding: 20px; border-radius: 20px; border: 2px solid #FFE0B2; font-family: 'Zen Maru Gothic', sans-serif; resize: vertical;"></textarea>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button class="tweet-button" onclick="saveReport()">ğŸ’¾ ä¿å­˜</button>
                <button class="tweet-button" onclick="copyReport()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
            </div>
        </div>
        
        <div class="card" id="feedbackCard" style="display: none;">
            <div class="card-title">ğŸ† AIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯</div>
            <div id="feedbackContent" style="background: #E8F5E9; padding: 20px; border-radius: 20px; border: 2px solid #81C784; color: #2E7D32; line-height: 1.8;"></div>
        </div>
        
        <div class="card" id="footprintCard" style="display: none;">
            <div class="card-title">ğŸ‘£ æˆé•·ã®ã‚ã—ã‚ã¨</div>
            <div id="footprintContent" style="background: #F3E5F5; padding: 20px; border-radius: 20px; border: 2px solid #BA68C8; color: #4A148C; line-height: 1.8;"></div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <button class="tweet-button" onclick="shareFootprint()">ğŸ”¥ ã‚·ã‚§ã‚¢ã™ã‚‹</button>
                <button class="tweet-button" onclick="copyFootprint()">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
            </div>
        </div>
    </div>
    
    <div id="journeyModal">
        <div class="journey-content">
            <button class="close-suggestion" onclick="closeJourney()" style="position: absolute; top: 20px; right: 25px;">Ã—</button>
            <div class="card-title" style="margin-bottom: 25px;">ğŸŒ± æˆé•·ã®è»Œè·¡</div>
            <div id="journey-thread"></div>
        </div>
    </div>
    
    <script src="config.js"></script>
    <script src="js/footprints.js"></script>
    <script src="js/home.js" defer></script>
    
    <script>
        // ã‚ã—ã‚ã¨é–²è¦§ä¾é ¼ã‚’è¡¨ç¤º
        function showViewRequest() {
            const viewRequests = document.getElementById('viewRequests');
            viewRequests.innerHTML = `
                <div class="view-request">
                    <div class="request-header">ğŸ‘€ ã‚ã—ã‚ã¨é–²è¦§ä¾é ¼</div>
                    <div class="request-content">
                        ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚ãªãŸã®æˆé•·ã®ã‚ã—ã‚ã¨ã‚’é–²è¦§ã—ãŸã„ã¨ç”³è«‹ã—ã¦ã„ã¾ã™ã€‚
                        æ‰¿èªã™ã‚‹ã¨ã€ã‚ãªãŸã®ã‚ã—ã‚ã¨ãŒã€Œã‚ã—ã‚ã¨ã®é‡Œã€ã§å…¬é–‹ã•ã‚Œã¾ã™ã€‚
                    </div>
                    <div class="request-buttons">
                        <button class="approve-btn" onclick="approveViewRequest()">âœ… æ‰¿èªï¼ˆå…¨ã¦å…¬é–‹ï¼‰</button>
                        <button class="reject-btn" onclick="rejectViewRequest()">âŒ æ‹’å¦</button>
                    </div>
                </div>
            `;
        }
        
        // ã‚ã—ã‚ã¨é–²è¦§ä¾é ¼ã‚’æ‰¿èª
        function approveViewRequest() {
            // å…¬é–‹ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
            localStorage.setItem('footprintPublic', 'true');
            
            // ç¾åœ¨ã®ã‚ã—ã‚ã¨ã‚’å…¬é–‹ç”¨ã«ä¿å­˜
            const footprintContent = document.getElementById('footprintContent')?.innerHTML;
            if (footprintContent) {
                const userName = document.getElementById('userName').textContent;
                const publicFootprint = {
                    id: Date.now(),
                    userName: userName,
                    content: footprintContent,
                    timestamp: new Date().toLocaleString('ja-JP'),
                    date: new Date().toISOString(),
                    isPublic: true
                };
                
                // å…¬é–‹ã‚ã—ã‚ã¨ãƒªã‚¹ãƒˆã«è¿½åŠ 
                const publicFootprints = JSON.parse(localStorage.getItem('publicFootprints') || '[]');
                publicFootprints.unshift(publicFootprint);
                localStorage.setItem('publicFootprints', JSON.stringify(publicFootprints));
            }
            
            // ä¾é ¼ã‚’éè¡¨ç¤º
            document.getElementById('viewRequests').innerHTML = '';
            
            alert('âœ… ã‚ã—ã‚ã¨é–²è¦§ã‚’æ‰¿èªã—ã¾ã—ãŸï¼\nã‚ãªãŸã®ã‚ã—ã‚ã¨ãŒã€Œã‚ã—ã‚ã¨ã®é‡Œã€ã§å…¬é–‹ã•ã‚Œã¾ã—ãŸã€‚');
        }
        
        // ã‚ã—ã‚ã¨é–²è¦§ä¾é ¼ã‚’æ‹’å¦
        function rejectViewRequest() {
            localStorage.setItem('footprintPublic', 'false');
            document.getElementById('viewRequests').innerHTML = '';
            alert('âŒ ã‚ã—ã‚ã¨é–²è¦§ã‚’æ‹’å¦ã—ã¾ã—ãŸã€‚');
        }
        function generateBearComment() {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const dateKey = yesterday.toISOString().split('T')[0];
            
            // å‰æ—¥ã®æ—¥å ±ã‚’å–å¾—
            const savedReports = JSON.parse(localStorage.getItem('savedReports') || '{}');
            const yesterdayReport = savedReports[dateKey];
            
            let comment = '';
            const userName = document.getElementById('userName').textContent || 'å¥å¤ªã•ã‚“';
            
            if (yesterdayReport) {
                // æ—¥å ±ãŒã‚ã‚‹å ´åˆã¯å†…å®¹ã‚’åˆ†æã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
                const content = yesterdayReport.content.toLowerCase();
                const title = yesterdayReport.title;
                
                const positiveComments = [
                    `<strong>ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€${userName}ï¼</strong><br>æ˜¨æ—¥ã®ã€Œ${title}ã€ã€ç´ æ™´ã‚‰ã—ã„å–ã‚Šçµ„ã¿ã§ã—ãŸã­ã€‚ä»Šæ—¥ã‚‚ãã®èª¿å­ã§é ‘å¼µã£ã¦ãã ã•ã„ï¼`,
                    `<strong>ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼</strong><br>æ˜¨æ—¥ã®æˆæœã‚’è¦‹ã¦ã„ã‚‹ã¨ã€${userName}ã®æˆé•·ãŒã‚ˆãã‚ã‹ã‚Šã¾ã™ã€‚ç‰¹ã«ã€Œ${title}ã€ã®éƒ¨åˆ†ã¯ç´ æ™´ã‚‰ã—ã„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ã—ãŸï¼`,
                    `<strong>${userName}ã€ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼</strong><br>æ˜¨æ—¥ã®æ—¥å ±ã‚’èª­ã‚“ã§ã€ã‚ãªãŸã®å‰å‘ããªå§¿å‹¢ã«æ„Ÿå‹•ã—ã¾ã—ãŸã€‚ä»Šæ—¥ã‚‚ãã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã§æ–°ã—ã„ä¸€æ­©ã‚’è¸ã¿å‡ºã—ã¦ãã ã•ã„ï¼`
                ];
                
                comment = positiveComments[Math.floor(Math.random() * positiveComments.length)];
            } else {
                // æ—¥å ±ãŒãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                const defaultComments = [
                    `<strong>ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€${userName}ï¼</strong><br>ä»Šæ—¥ã‚‚æ–°ã—ã„ä¸€æ—¥ã®å§‹ã¾ã‚Šã§ã™ã­ã€‚ä¸€ç·’ã«é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼ä½•ã‹ã¤ã¶ã‚„ããŸã„ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ`,
                    `<strong>${userName}ã€ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼</strong><br>ä»Šæ—¥ã¯ã©ã‚“ãªã“ã¨ã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã¾ã™ã‹ï¼Ÿã‚ãªãŸã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ï¼`,
                    `<strong>ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ï¼</strong><br>${userName}ã®æˆé•·ã‚’ã„ã¤ã‚‚å¿œæ´ã—ã¦ã„ã¾ã™ã€‚ä»Šæ—¥ã‚‚ç´ æ™´ã‚‰ã—ã„ä¸€æ—¥ã«ã—ã¾ã—ã‚‡ã†ï¼`
                ];
                
                comment = defaultComments[Math.floor(Math.random() * defaultComments.length)];
            }
            
            document.getElementById('aiMessage').innerHTML = comment;
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç”¨ã®ç°¡å˜ãªé–¢æ•°
        let tweets = [];
        
        if (typeof postTweet === 'undefined') {
            function postTweet() {
                const input = document.getElementById('tweetInput');
                const text = input.value.trim();
                if (!text) return;
                
                // æ„Ÿæƒ…åˆ†æ
                const isPositive = /å¬‰ã—ã„|æ¥½ã—ã„|è‰¯ã„|æˆåŠŸ|ã§ããŸ|é ‘å¼µ|ã‚ã‚ŠãŒã¨|å®Œäº†|é †èª¿|ã†ã¾ã|ã‚ˆã‹ã£ãŸ|ç†è§£/.test(text);
                const isNegative = /é›£ã—ã„|å›°|å¤§å¤‰|ç–²|è¾›|ã§ããªã„|ã‚ã‹ã‚‰ãªã„|è‹¦æ‰‹|å•é¡Œ|ã‚¨ãƒ©ãƒ¼|å¤±æ•—|ã†ã¾ãã„ã‹ãªã„/.test(text);
                const isTask = /ä½œã‚‹|ä½œæˆ|å¯¾å¿œ|æº–å‚™|å®Ÿæ–½|ã‚„ã‚‹|ã™ã‚‹|ã—ãªã„ã¨|ã¾ã§/.test(text);
                
                const now = new Date();
                const tweet = {
                    text: text,
                    time: now,
                    isPositive: isPositive,
                    isNegative: isNegative,
                    isTask: isTask
                };
                
                tweets.unshift(tweet);
                input.value = '';
                
                // ã¤ã¶ã‚„ãå±¥æ­´ã‚’æ›´æ–°
                renderTweetHistory();
                
                // AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ›´æ–°
                const responses = [
                    `ã€Œ${text.substring(0, 20)}...ã€ã§ã™ã­ã€‚ãã®æ°—æŒã¡ã€ã‚ˆãã‚ã‹ã‚Šã¾ã™ï¼`,
                    `ã¤ã¶ã‚„ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼${isNegative ? 'é›£ã—ã„ã¨ãã“ãæˆé•·ã®ãƒãƒ£ãƒ³ã‚¹ã§ã™' : 'é †èª¿ãã†ã§ã™ã­'}âœ¨`,
                    `ã€Œ${text.substring(0, 15)}...ã€ã„ã„ã§ã™ã­ï¼ãã®èª¿å­ã§é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ğŸš€`
                ];
                
                document.getElementById('aiMessage').innerHTML = `<strong>å¥å¤ªã•ã‚“ã€</strong><br>${responses[Math.floor(Math.random() * responses.length)]}`;
            }
        }
        
        function renderTweetHistory() {
            const container = document.getElementById('tweetHistory');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (tweets.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ä»Šæ—¥ã®ã¤ã¶ã‚„ãã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
            
            tweets.forEach(tweet => {
                const item = document.createElement('div');
                item.className = 'tweet-item';
                const timeStr = `${tweet.time.getHours()}:${String(tweet.time.getMinutes()).padStart(2, '0')}`;
                
                let tags = '';
                if (tweet.isTask) tags += '<span class="tag tag-task">ğŸ“‹ æ¥­å‹™ã‚¿ã‚¹ã‚¯</span>';
                if (tweet.isPositive) tags += '<span class="tag tag-positive">ğŸ˜Š ãƒã‚¸ãƒ†ã‚£ãƒ–</span>';
                if (tweet.isNegative) tags += '<span class="tag tag-negative">ğŸ˜° ãƒã‚¬ãƒ†ã‚£ãƒ–</span>';
                
                item.innerHTML = `
                    <div class="tweet-header">
                        <span class="tweet-time">${timeStr}</span>
                    </div>
                    <div class="tweet-text">${tweet.text}</div>
                    <div class="tweet-tags">${tags}</div>
                `;
                container.appendChild(item);
            });
        }
        
        // åˆæœŸè¡¨ç¤º
        document.addEventListener('DOMContentLoaded', function() {
            generateBearComment();
            renderTweetHistory();
            loadSavedReports();
            
            // ã‚ã—ã‚ã¨é–²è¦§ä¾é ¼ã‚’è¡¨ç¤ºï¼ˆåˆå›ã®ã¿ï¼‰
            const hasShownRequest = localStorage.getItem('hasShownViewRequest');
            if (!hasShownRequest) {
                setTimeout(() => {
                    showViewRequest();
                    localStorage.setItem('hasShownViewRequest', 'true');
                }, 2000);
            }
        });
        
        // æ—¥å ±ç”Ÿæˆé–¢æ•°
        function generateReport() {
            const today = new Date();
            const dateStr = `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
            
            const schedule = [
                '09:00-10:00 ãƒãƒ¼ãƒ ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°',
                '10:00-12:00 é–‹ç™ºä½œæ¥­',
                '13:00-15:00 ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼',
                '15:00-17:00 èª²é¡Œå¯¾å¿œ'
            ];
            
            // ã¤ã¶ã‚„ãã‹ã‚‰ã‚¿ã‚¹ã‚¯ã‚’æŠ½å‡º
            const taskTweets = tweets.filter(t => t.isTask);
            const positiveTweets = tweets.filter(t => t.isPositive);
            const negativeTweets = tweets.filter(t => t.isNegative);
            
            let tasks = '';
            if (taskTweets.length > 0) {
                tasks = taskTweets.map(t => `ãƒ» ${t.text}`).join('\n');
            } else {
                tasks = 'ãƒ» é€šå¸¸æ¥­å‹™ã‚’å®Ÿæ–½ã—ã¾ã—ãŸ';
            }
            
            let insights = '';
            if (positiveTweets.length > 0) {
                insights += 'ãƒ» é †èª¿ã«æ¥­å‹™ã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸ\n';
                insights += positiveTweets.map(t => `  - ${t.text}`).join('\n') + '\n\n';
            }
            if (negativeTweets.length > 0) {
                insights += 'ãƒ» ã„ãã¤ã‹ã®èª²é¡ŒãŒã‚ã‚Šã¾ã—ãŸãŒã€è§£æ±ºã«å‘ã‘ã¦é€²ã‚ã¦ã„ã¾ã™\n';
                insights += negativeTweets.map(t => `  - ${t.text}`).join('\n');
            }
            if (!insights) {
                insights = 'ãƒ» é †èª¿ã«æ¥­å‹™ã‚’é€²ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸ';
            }
            
            const report = `${dateStr}ã®æ—¥å ±

â– ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
${schedule.join('\n')}

â– å–ã‚Šçµ„ã‚“ã ã“ã¨
${tasks}

â– æ°—ã¥ã
${insights}`;
            
            document.getElementById('reportContent').value = report;
            document.getElementById('reportCard').style.display = 'block';
            document.getElementById('reportCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        // æ—¥å ±ä¿å­˜é–¢æ•°
        function saveReport() {
            const content = document.getElementById('reportContent').value;
            if (!content.trim()) {
                alert('æ—¥å ±ã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const today = new Date();
            const dateStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
            const title = generateReportTitle(content);
            
            // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            const savedReports = JSON.parse(localStorage.getItem('savedReports') || '{}');
            savedReports[dateStr] = {
                title: title,
                content: content,
                date: dateStr,
                timestamp: Date.now()
            };
            localStorage.setItem('savedReports', JSON.stringify(savedReports));
            
            alert('æ—¥å ±ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            
            // AIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ç”Ÿæˆ
            generateAIFeedback(content);
            
            // éå»æ—¥å ±ä¸€è¦§ã‚’æ›´æ–°
            loadSavedReports();
        }
        
        // æ—¥å ±ã‚¿ã‚¤ãƒˆãƒ«ç”Ÿæˆ
        function generateReportTitle(content) {
            if (content.includes('API') || content.includes('è¨­è¨ˆ')) {
                return 'APIè¨­è¨ˆã¨ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã®é€²å±•';
            } else if (content.includes('ãƒãƒ¼ãƒ ') || content.includes('ä¼šè­°')) {
                return 'ãƒãƒ¼ãƒ ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–ã®ä¸€æ—¥';
            } else if (content.includes('å­¦ç¿’') || content.includes('èª¿æŸ»')) {
                return 'æŠ€è¡“å­¦ç¿’ã¨çŸ¥è­˜å‘ä¸Šã¸ã®å–ã‚Šçµ„ã¿';
            } else {
                return 'æ—¥ã€…ã®æ¥­å‹™ã¨æˆé•·ã®è¨˜éŒ²';
            }
        }
        
        // AIãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ç”Ÿæˆ
        function generateAIFeedback(content) {
            const feedbacks = [
                {
                    point: 'ç¶™ç¶šçš„ãªå­¦ç¿’å§¿å‹¢',
                    comment: 'æ–°ã—ã„æŠ€è¡“ã‚„çŸ¥è­˜ã®ç¿’å¾—ã«ç©æ¥µçš„ã«å–ã‚Šçµ„ã‚“ã§ã„ã‚‹å§¿å‹¢ãŒç´ æ™´ã‚‰ã—ã„ã§ã™ã€‚ã“ã®ç¶™ç¶šçš„ãªå­¦ç¿’æ„æ¬²ã¯ã€é•·æœŸçš„ãªã‚­ãƒ£ãƒªã‚¢æˆé•·ã®åŸºç›¤ã¨ãªã‚Šã¾ã™ã€‚'
                },
                {
                    point: 'ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å‘ä¸Š',
                    comment: 'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¨ã®é€£æºã‚„æƒ…å ±å…±æœ‰ã‚’é‡è¦–ã—ã¦ã„ã‚‹ç‚¹ãŒè©•ä¾¡ã§ãã¾ã™ã€‚è‰¯å¥½ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæˆåŠŸã®é‡è¦ãªè¦ç´ ã§ã™ã€‚'
                },
                {
                    point: 'å•é¡Œè§£æ±ºèƒ½åŠ›ã®ç™ºæ®',
                    comment: 'èª²é¡Œã«å¯¾ã—ã¦è«–ç†çš„ã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã—ã€è§£æ±ºç­–ã‚’è¦‹ã¤ã‘å‡ºã™èƒ½åŠ›ãŒå‘ä¸Šã—ã¦ã„ã¾ã™ã€‚ã“ã®åˆ†æåŠ›ã¯ä»Šå¾Œã®è¤‡é›‘ãªå•é¡Œè§£æ±ºã«æ´»ã‹ã•ã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚'
                }
            ];
            
            const selectedFeedback = feedbacks[Math.floor(Math.random() * feedbacks.length)];
            
            const feedbackHtml = `
                <div style="margin-bottom: 15px;">
                    <strong>ğŸŒŸ æˆé•·ãƒã‚¤ãƒ³ãƒˆ: ${selectedFeedback.point}</strong>
                </div>
                <div>${selectedFeedback.comment}</div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #C8E6C9; font-size: 14px; color: #66BB6A;">
                    ğŸ’¡ ä»Šå¾Œã‚‚ç¶™ç¶šçš„ãªæŒ¯ã‚Šè¿”ã‚Šã¨æ”¹å–„ã‚’å¿ƒãŒã‘ã‚‹ã“ã¨ã§ã€ã•ã‚‰ãªã‚‹æˆé•·ãŒæœŸå¾…ã§ãã¾ã™ã€‚
                </div>
            `;
            
            document.getElementById('feedbackContent').innerHTML = feedbackHtml;
            document.getElementById('feedbackCard').style.display = 'block';
            document.getElementById('feedbackCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        // éå»æ—¥å ±èª­ã¿è¾¼ã¿
        function loadSavedReports() {
            const savedReports = JSON.parse(localStorage.getItem('savedReports') || '{}');
            const reportList = document.getElementById('reportList');
            
            reportList.innerHTML = '';
            
            const sortedReports = Object.values(savedReports).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedReports.forEach(report => {
                const reportDiv = document.createElement('div');
                reportDiv.className = 'report-item';
                reportDiv.innerHTML = `
                    <div onclick="toggleReportContent('${report.date}')" style="cursor: pointer;">
                        <div style="color: #FF9800; font-weight: bold; margin-bottom: 5px;">
                            ${report.date.replace(/-/g, '/')} ${report.title}
                        </div>
                    </div>
                    <div id="content-${report.date}" class="report-content" style="display: none;">
                        ${report.content.replace(/\n/g, '<br>')}
                    </div>
                `;
                reportList.appendChild(reportDiv);
            });
            
            if (sortedReports.length === 0) {
                addDefaultReports();
            }
        }
        
        function toggleReportContent(date) {
            const contentDiv = document.getElementById(`content-${date}`);
            if (contentDiv) {
                contentDiv.style.display = contentDiv.style.display === 'none' ? 'block' : 'none';
            }
        }
        
        function addDefaultReports() {
            const defaultReports = {
                '2024-01-15': {
                    title: 'APIè¨­è¨ˆã¨ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºã®é€²å±•',
                    content: 'â– ä»Šæ—¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«\n09:00-10:00 ãƒãƒ¼ãƒ ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°\n10:00-12:00 APIè¨­è¨ˆæ›¸ä½œæˆ\n\nâ– å–ã‚Šçµ„ã‚“ã ã“ã¨\nãƒ»APIè¨­è¨ˆæ›¸ã®ä½œæˆã‚’å®Œäº†ã—ã¾ã—ãŸ\n\nâ– æ°—ã¥ã\nãƒ»è¨­è¨ˆæ®µéšã§ã®è©³ç´°ãªæ¤œè¨ãŒé‡è¦ã§ã‚ã‚‹ã“ã¨ã‚’å†èªè­˜ã—ã¾ã—ãŸ',
                    date: '2024-01-15',
                    timestamp: Date.now() - 86400000
                }
            };
            
            localStorage.setItem('savedReports', JSON.stringify(defaultReports));
            loadSavedReports();
        }
        
        function copyReport() {
            const text = document.getElementById('reportContent').value;
            navigator.clipboard.writeText(text).then(() => {
                alert('æ—¥å ±ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }
        
        // ã‚ã—ã‚ã¨ç”Ÿæˆé–¢æ•°
        function generateFootprint() {
            const savedReports = JSON.parse(localStorage.getItem('savedReports') || '{}');
            const reports = Object.values(savedReports);
            
            if (reports.length === 0) {
                alert('æ—¥å ±ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšæ—¥å ±ã‚’ä½œæˆãƒ»ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // éå»1é€±é–“ã®æ—¥å ±ã‚’å–å¾—ï¼ˆãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ï¼‰
            const oneWeekAgo = new Date();
            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
            
            const recentReports = reports.filter(report => {
                const reportDate = new Date(report.date);
                return reportDate >= oneWeekAgo;
            });
            
            // ãƒã‚¬ãƒ†ã‚£ãƒ–/ãƒã‚¸ãƒ†ã‚£ãƒ–è¦ç´ ã‚’åˆ†æ
            const analysis = analyzeReportsForFootprint(recentReports);
            
            // AIè©•ä¾¡ã‚’ç”Ÿæˆ
            const footprintReport = generateFootprintReport(analysis, recentReports.length);
            
            document.getElementById('footprintContent').innerHTML = footprintReport;
            document.getElementById('footprintCard').style.display = 'block';
            document.getElementById('footprintCard').scrollIntoView({ behavior: 'smooth' });
        }
        
        function analyzeReportsForFootprint(reports) {
            let positiveCount = 0;
            let negativeCount = 0;
            let totalEntries = 0;
            let skillAreas = [];
            let challenges = [];
            let achievements = [];
            
            reports.forEach(report => {
                const content = report.content.toLowerCase();
                totalEntries++;
                
                // ãƒã‚¸ãƒ†ã‚£ãƒ–ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
                const positiveWords = ['å®Œäº†', 'æˆåŠŸ', 'é †èª¿', 'ã†ã¾ã', 'è‰¯ã„', 'å‘ä¸Š', 'ç†è§£', 'é€²æ—'];
                const negativeWords = ['å›°', 'é›£ã—ã„', 'èª²é¡Œ', 'å•é¡Œ', 'å¤±æ•—', 'ã‚¨ãƒ©ãƒ¼', 'è‹¦æ‰‹', 'å¤§å¤‰'];
                
                positiveWords.forEach(word => {
                    if (content.includes(word)) positiveCount++;
                });
                
                negativeWords.forEach(word => {
                    if (content.includes(word)) negativeCount++;
                });
                
                // ã‚¹ã‚­ãƒ«ã‚¨ãƒªã‚¢ã‚’æŠ½å‡º
                if (content.includes('api') || content.includes('è¨­è¨ˆ')) skillAreas.push('ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ');
                if (content.includes('ãƒãƒ¼ãƒ ') || content.includes('ä¼šè­°')) skillAreas.push('ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³');
                if (content.includes('å­¦ç¿’') || content.includes('èª¿æŸ»')) skillAreas.push('æŠ€è¡“å­¦ç¿’');
            });
            
            return {
                positiveRatio: totalEntries > 0 ? (positiveCount / (positiveCount + negativeCount)) * 100 : 50,
                negativeRatio: totalEntries > 0 ? (negativeCount / (positiveCount + negativeCount)) * 100 : 50,
                skillAreas: [...new Set(skillAreas)],
                totalReports: totalEntries,
                trend: positiveCount > negativeCount ? 'positive' : negativeCount > positiveCount ? 'negative' : 'stable'
            };
        }
        
        function generateFootprintReport(analysis, reportCount) {
            const templates = [
                {
                    condition: analysis.trend === 'positive',
                    report: `
                        <div style="margin-bottom: 20px;">
                            <strong>ğŸŒ± æˆé•·ã®è»Œè·¡ãŒæ˜ç¢ºã«è¦‹ãˆã¦ã„ã¾ã™</strong>
                        </div>
                        <div style="margin-bottom: 15px;">
                            éå»1é€±é–“ã®${reportCount}ä»¶ã®æ—¥å ±ã‚’åˆ†æã—ãŸçµæœã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªè¦ç´ ãŒ${Math.round(analysis.positiveRatio)}%ã‚’å ã‚ã¦ãŠã‚Šã€ç€å®Ÿãªæˆé•·ã‚’é‚ã’ã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>ğŸ“Š ç‰¹ã«æ³¨ç›®ã™ã¹ãæˆé•·ãƒã‚¤ãƒ³ãƒˆ:</strong><br>
                            ãƒ» å•é¡Œè§£æ±ºèƒ½åŠ›ã®å‘ä¸Š: èª²é¡Œã«å¯¾ã—ã¦ç©æ¥µçš„ã«å–ã‚Šçµ„ã¿ã€è§£æ±ºã«å°ãå§¿å‹¢ãŒè¦‹ã‚‰ã‚Œã¾ã™<br>
                            ãƒ» ç¶™ç¶šçš„ãªå­¦ç¿’æ„æ¬²: æ–°ã—ã„æŠ€è¡“ã‚„çŸ¥è­˜ã®ç¿’å¾—ã«æ„æ¬²çš„ã§ã€è‡ªå·±æˆé•·ã¸ã®ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆãŒå¼·ã„<br>
                            ãƒ» ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®å……å®Ÿ: ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‡è¦–ã—ã€ãƒãƒ¼ãƒ å…¨ä½“ã®æˆæœã«è²¢çŒ®ã—ã¦ã„ã‚‹
                        </div>
                        <div style="padding: 15px; background: #E8F5E9; border-radius: 10px; border-left: 4px solid #4CAF50;">
                            <strong>ğŸ† ç·åˆè©•ä¾¡:</strong> ç¾åœ¨ã®æˆé•·ãƒšãƒ¼ã‚¹ã¯éå¸¸ã«è‰¯å¥½ã§ã™ã€‚ã“ã®èª¿å­ã§ç¶™ç¶šã™ã‚‹ã“ã¨ã§ã€ã•ã‚‰ãªã‚‹ã‚¹ã‚­ãƒ«å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚
                        </div>
                    `
                },
                {
                    condition: analysis.trend === 'negative',
                    report: `
                        <div style="margin-bottom: 20px;">
                            <strong>ğŸŒ± æŒ‘æˆ¦ã¨æˆé•·ã®æ™‚æœŸã§ã™</strong>
                        </div>
                        <div style="margin-bottom: 15px;">
                            éå»1é€±é–“ã®${reportCount}ä»¶ã®æ—¥å ±ã‚’åˆ†æã—ãŸçµæœã€èª²é¡Œã‚„å›°é›£ã«ç›´é¢ã™ã‚‹æ©Ÿä¼šãŒå¤šãã€ã“ã‚Œã¯æˆé•·ã®ãŸã‚ã®é‡è¦ãªãƒ—ãƒ­ã‚»ã‚¹ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>ğŸ’ª æ³¨ç›®ã™ã¹ãæˆé•·ãƒã‚¤ãƒ³ãƒˆ:</strong><br>
                            ãƒ» å›°é›£ã«ç«‹ã¡å‘ã‹ã†å‹‡æ°—: èª²é¡Œã‹ã‚‰é€ƒã’ãšã«ç«‹ã¡å‘ã‹ã†å§¿å‹¢ãŒè¦‹ã‚‰ã‚Œã¾ã™<br>
                            ãƒ» å•é¡Œæ„è­˜ã®é«˜ã•: ç¾çŠ¶ã‚’æ­£ç¢ºã«æŠŠæ¡ã—ã€æ”¹å–„ç‚¹ã‚’æ˜ç¢ºã«ã—ã¦ã„ã‚‹<br>
                            ãƒ» å­¦ç¿’æ„æ¬²ã®ç¶­æŒ: å›°é›£ãªçŠ¶æ³ã§ã‚‚å­¦ã³ç¶šã‘ã‚‹æ„æ¬²ã‚’æŒã¡ç¶šã‘ã¦ã„ã‚‹
                        </div>
                        <div style="padding: 15px; background: #FFF3E0; border-radius: 10px; border-left: 4px solid #FF9800;">
                            <strong>ğŸ† ç·åˆè©•ä¾¡:</strong> ç¾åœ¨ã¯æŒ‘æˆ¦çš„ãªæ™‚æœŸã§ã™ãŒã€ã“ã®çµŒé¨“ãŒå°†æ¥ã®å¤§ããªæˆé•·ã®åœŸå°ã¨ãªã‚Šã¾ã™ã€‚ç¶™ç¶šã—ã¦å–ã‚Šçµ„ã‚€ã“ã¨ã§ã€å¿…ãšãƒ–ãƒ¬ã‚¤ã‚¯ã‚¹ãƒ«ãƒ¼ãŒè¨ªã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚
                        </div>
                    `
                },
                {
                    condition: true, // default
                    report: `
                        <div style="margin-bottom: 20px;">
                            <strong>ğŸŒ± ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæˆé•·ã‚’ç¶šã‘ã¦ã„ã¾ã™</strong>
                        </div>
                        <div style="margin-bottom: 15px;">
                            éå»1é€±é–“ã®${reportCount}ä»¶ã®æ—¥å ±ã‚’åˆ†æã—ãŸçµæœã€ãƒã‚¸ãƒ†ã‚£ãƒ–ã¨ãƒã‚¬ãƒ†ã‚£ãƒ–ã®è¦ç´ ãŒãƒãƒ©ãƒ³ã‚¹ã‚ˆãå­˜åœ¨ã—ã€å¥å…¨ãªæˆé•·ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ­©ã‚“ã§ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
                        </div>
                        <div style="margin-bottom: 15px;">
                            <strong>ğŸ† æ³¨ç›®ã™ã¹ãæˆé•·ãƒã‚¤ãƒ³ãƒˆ:</strong><br>
                            ãƒ» ç¾å®Ÿçš„ãªç›®æ¨™è¨­å®š: é©åˆ‡ãªãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ¬ãƒ™ãƒ«ã§ç›®æ¨™ã‚’è¨­å®šã—ã¦ã„ã‚‹<br>
                            ãƒ» ç¶™ç¶šçš„ãªæ”¹å–„æ„è­˜: æˆåŠŸã¨å¤±æ•—ã®ä¸¡æ–¹ã‹ã‚‰å­¦ã³ã€æ”¹å–„ã—ç¶šã‘ã¦ã„ã‚‹<br>
                            ãƒ» å®‰å®šã—ãŸãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: ä¸€å®šã®å“è³ªã§æ¥­å‹™ã‚’é‚è¡Œã§ãã¦ã„ã‚‹
                        </div>
                        <div style="padding: 15px; background: #E3F2FD; border-radius: 10px; border-left: 4px solid #2196F3;">
                            <strong>ğŸ† ç·åˆè©•ä¾¡:</strong> ç€å®Ÿãªæˆé•·ã‚’ç¶šã‘ã¦ãŠã‚Šã€ä»Šå¾Œã‚‚ã“ã®ãƒšãƒ¼ã‚¹ã§ç¶™ç¶šã™ã‚‹ã“ã¨ã§ã€å®‰å®šã—ãŸã‚¹ã‚­ãƒ«å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚
                        </div>
                    `
                }
            ];
            
            const selectedTemplate = templates.find(t => t.condition) || templates[templates.length - 1];
            return selectedTemplate.report;
        }
        
        function shareFootprint() {
            const footprintContent = document.getElementById('footprintContent').innerHTML;
            const userName = document.getElementById('userName').textContent;
            const timestamp = new Date().toLocaleString('ja-JP');
            
            // ã‚·ã‚§ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
            const sharedFootprints = JSON.parse(localStorage.getItem('sharedFootprints') || '[]');
            const newFootprint = {
                id: Date.now(),
                userName: userName,
                content: footprintContent,
                timestamp: timestamp,
                date: new Date().toISOString()
            };
            
            sharedFootprints.unshift(newFootprint);
            // æœ€å¤§10ä»¶ã¾ã§ä¿å­˜
            if (sharedFootprints.length > 10) {
                sharedFootprints.pop();
            }
            
            localStorage.setItem('sharedFootprints', JSON.stringify(sharedFootprints));
            
            alert('ğŸ”¥ ã‚ã—ã‚ã¨ã‚’å¤œã®ãŸãç«åºƒå ´ã«ã‚·ã‚§ã‚¢ã—ã¾ã—ãŸï¼\nä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–²è¦§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚');
        }
        
        function copyFootprint() {
            const footprintText = document.getElementById('footprintContent').innerText;
            navigator.clipboard.writeText(footprintText).then(() => {
                alert('ã‚ã—ã‚ã¨ãƒ¬ãƒãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
            });
        }
        
        if (typeof viewReport === 'undefined') {
            function viewReport(date) {
                alert('æ—¥å ±ã‚’è¡¨ç¤º: ' + date);
            }
        }
        
        if (typeof allowDrop === 'undefined') {
            function allowDrop(ev) { ev.preventDefault(); }
            function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
            function drop(ev) {
                ev.preventDefault();
                const data = ev.dataTransfer.getData("text");
                const task = document.getElementById(data);
                const column = ev.target.closest('.kanban-column');
                if (column && task) {
                    column.appendChild(task);
                    if (column.dataset.column === 'done') {
                        document.getElementById('aiMessage').innerHTML = `<strong>ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼</strong><br>ã€Œ${task.querySelector('.task-title').textContent}ã€ã‚’å®Œäº†ã—ã¾ã—ãŸï¼`;
                    }
                }
            }
        }
    </script>

</body>
</html>
